var Students = {
  "HashemBuzer": {
    "pastPairs": [
      "OmarBara",
      "BilelGharbi",
      "MohamedSbeta"
    ],
    "Solo": false,
    "img": "HashemBuzer.jpg"
  },
  "OmarBara": {
    "pastPairs": [
      "HashemBuzer",
      "HeniMezrani",
      "AliJalal"
    ],
    "Solo": false,
    "img": "OmarBara.jpg"
  },
  "MohamedAmineAouini": {
    "pastPairs": [
      "HaniaLazreg",
      "AliJalal",
      "EssamFaraj"
    ],
    "Solo": false,
    "img": "MohamedAmineAouini.jpg"
  },
  "HaniaLazreg": {
    "pastPairs": [
      "MohamedAmineAouini",
      "JihedAbdelly",
      "HoudaRouaissi"
    ],
    "Solo": false,
    "img": "HaniaLazreg.jpg"
  },
  "MohamedBelkheir": {
    "pastPairs": [
      "MehdiFarjallah",
      "HamamElmurtdh",
      "DhiaRaissi"
    ],
    "Solo": true,
    "img": "MohamedBelkheir.jpg"
  },
  "MehdiFarjallah": {
    "pastPairs": [
      "MohamedBelkheir",
      "FirasAmous"
    ],
    "Solo": false,
    "img": "MehdiFarjallah.jpg"
  },
  "AbdelsalamShahlol": {
    "pastPairs": [
      "MohamedFared",
      "OnsRahmani",
      "MuftahElzawi"
    ],
    "Solo": false,
    "img": "AbdelsalamShahlol.jpg"
  },
  "MohamedFared": {
    "pastPairs": [
      "AbdelsalamShahlol",
      "ZiedBarhoumi",
      "HamzaDanden"
    ],
    "Solo": false,
    "img": "MohamedFared.jpg"
  },
  "FirasAmous": {
    "pastPairs": [
      "HamamElmurtdh",
      "MehdiFarjallah",
      "FaroukGuizeni"
    ],
    "Solo": false,
    "img": "FirasAmous.jpg"
  },
  "HamamElmurtdh": {
    "pastPairs": [
      "FirasAmous",
      "MohamedBelkheir",
      "HeniMezrani"
    ],
    "Solo": false,
    "img": "HamamElmurtdh.jpg"
  },
  "ZiedBarhoumi": {
    "pastPairs": [
      "HeniMezrani",
      "MohamedFared",
      "KhoubaiebGhaouari"
    ],
    "Solo": false,
    "img": "ZiedBarhoumi.jpg"
  },
  "HeniMezrani": {
    "pastPairs": [
      "ZiedBarhoumi",
      "OmarBara",
      "HamamElmurtdh"
    ],
    "Solo": false,
    "img": "HeniMezrani.jpg"
  },
  "SalimAliAlsaeh": {
    "pastPairs": [
      "AliJalal",
      "MohamedSbeta",
      "AbdoAlabed"
    ],
    "Solo": false,
    "img": "SalimAliAlsaeh.jpg"
  },
  "AliJalal": {
    "pastPairs": [
      "SalimAliAlsaeh",
      "MohamedAmineAouini",
      "OmarBara"
    ],
    "Solo": false,
    "img": "AliJalal.jpg"
  },
  "OnsRahmani": {
    "pastPairs": [
      "NejahSafi",
      "AbdelsalamShahlol",
      "AmeraAyad"
    ],
    "Solo": false,
    "img": "OnsRahmani.jpg"
  },
  "NejahSafi": {
    "pastPairs": [
      "OnsRahmani",
      "FoozBarakat",
      "SofianSaleh"
    ],
    "Solo": false,
    "img": "NejahSafi.jpg"
  },
  "HoudaRouaissi": {
    "pastPairs": [
      "FoozBarakat",
      "MaherBouzid",
      "HaniaLazreg"
    ],
    "Solo": false,
    "img": "HoudaRouaissi.jpg"
  },
  "FoozBarakat": {
    "pastPairs": [
      "HoudaRouaissi",
      "NejahSafi",
      "MalikAbdullah"
    ],
    "Solo": false,
    "img": "FoozBarakat.jpg"
  },
  "JihedAbdelly": {
    "pastPairs": [
      "MaherBouzid",
      "HaniaLazreg",
      "FatimaMabrook"
    ],
    "Solo": false,
    "img": "JihedAbdelly.jpg"
  },
  "MaherBouzid": {
    "pastPairs": [
      "JihedAbdelly",
      "HoudaRouaissi",
      "AhmedWheida"
    ],
    "Solo": false,
    "img": "MaherBouzid.jpg"
  },
  "MalikAbdullah": {
    "pastPairs": [
      "HamzaDanden",
      "TahaZnazen",
      "FoozBarakat"
    ],
    "Solo": false,
    "img": "MalikAbdullah.jpg"
  },
  "HamzaDanden": {
    "pastPairs": [
      "MalikAbdullah",
      "FaresJelassi",
      "MohamedFared"
    ],
    "Solo": false,
    "img": "HamzaDanden.jpg"
  },
  "FaresJelassi": {
    "pastPairs": [
      "TahaZnazen",
      "HamzaDanden",
      "RubaArifElwahieshi"
    ],
    "Solo": false,
    "img": "FaresJelassi.jpg"
  },
  "TahaZnazen": {
    "pastPairs": [
      "FaresJelassi",
      "MalikAbdullah",
      "MohamedAmineSlaimia",
      "InsafMechergui"
    ],
    "Solo": true,
    "img": "TahaZnazen.jpg"
  },
  "KhoubaiebGhaouari": {
    "pastPairs": [
      "WajdiHamrouni",
      "MuftahElzawi",
      "ZiedBarhoumi"
    ],
    "Solo": false,
    "img": "KhoubaiebGhaouari.jpg"
  },
  "WajdiHamrouni": {
    "pastPairs": [
      "KhoubaiebGhaouari",
      "FatimaMabrook",
      "BilelGharbi"
    ],
    "Solo": false,
    "img": "WajdiHamrouni.jpg"
  },
  "RubaArifElwahieshi": {
    "pastPairs": [
      "AmeraAyad",
      "TahaMejri",
      "FaresJelassi"
    ],
    "Solo": false,
    "img": "RubaArifElwahieshi.jpg"
  },
  "AmeraAyad": {
    "pastPairs": [
      "AubaArifElwahieshi",
      "FaroukGuizeni",
      "OnsRahmani"
    ],
    "Solo": false,
    "img": "AmeraAyad.jpg"
  },
  "FaroukGuizeni": {
    "pastPairs": [
      "TahaMejri",
      "AmeraAyad",
      "FirasAmous"
    ],
    "Solo": false,
    "img": "FaroukGuizeni.jpg"
  },
  "TahaMejri": {
    "pastPairs": [
      "FaroukGuizeni",
      "AubaArifElwahieshi"
    ],
    "Solo": false,
    "img": "TahaMejri.jpg"
  },
  "FatimaMabrook": {
    "pastPairs": [
      "AnasMarzouki",
      "WajdiHamrouni",
      "JihedAbdelly"
    ],
    "Solo": false,
    "img": "FatimaMabrook.jpg"
  },
  "AnasMarzouki": {
    "pastPairs": [
      "FatimaMabrook",
      "LinaBenSalem"
    ],
    "Solo": true,
    "img": "AnasMarzouki.jpg"
  },
  "AbdoAlabed": {
    "pastPairs": [
      "MohamedAmineSlaimia",
      "SalimAliAlsaeh"
    ],
    "Solo": false,
    "img": "AbdoAlabed.jpg"
  },
  "MohamedAmineSlaimia": {
    "pastPairs": [
      "AbdoAlabed",
      "TahaZnazen"
    ],
    "Solo": false,
    "img": "MohamedAmineSlaimia.jpg"
  },
  "MohamedDhiaWeslati": {
    "pastPairs": [
      "AhmedWheida",
      "EssamFaraj",
      "AbdulrahmanShibani"
    ],
    "Solo": false,
    "img": "MohamedDhiaWeslati.jpg"
  },
  "AhmedWheida": {
    "pastPairs": [
      "MohamedDhiaWeslati",
      "AdnenBenAbdelaali",
      "MaherBouzid"
    ],
    "Solo": false,
    "img": "AhmedWheida.jpg"
  },
  "DhiaRaissi": {
    "pastPairs": [
      "AdamMomen",
      "SofianSaleh",
      "MohamedBelkheir"
    ],
    "Solo": false,
    "img": "DhiaRaissi.jpg"
  },
  "AdamMomen": {
    "pastPairs": [
      "DhiaRaissi",
      "AbdulrahmanShibani",
      "AdnenBenAbdelaali"
    ],
    "Solo": false,
    "img": "AdamMomen.jpg"
  },
  "AbdulrahmanShibani": {
    "pastPairs": [
      "SofianSaleh",
      "AdamMomen",
      "MohamedDhiaWeslati"
    ],
    "Solo": false,
    "img": "AbdulrahmanShibani.jpg"
  },
  "SofianSaleh": {
    "pastPairs": [
      "AbdulrahmanShibani",
      "DhiaRaissi",
      "NejahSafi"
    ],
    "Solo": false,
    "img": "SofianSaleh.jpg"
  },
  "EssamFaraj": {
    "pastPairs": [
      "MuftahElzawi",
      "MohamedDhiaWeslati",
      "MohamedAmineAouini"
    ],
    "Solo": false,
    "img": "EssamFaraj.jpg"
  },
  "MuftahElzawi": {
    "pastPairs": [
      "EssamFaraj",
      "KhoubaiebGhaouari",
      "AbdelsalamShahlol"
    ],
    "Solo": false,
    "img": "MuftahElzawi.jpg"
  },
  "InsafMechergui": {
    "pastPairs": [
      "LinaBenSalem",
      "TahaZnazen"
    ],
    "Solo": false,
    "img": "InsafMechergui.jpg"
  },
  "LinaBenSalem": {
    "pastPairs": [
      "InsafMechergui",
      "AnasMarzouki"
    ],
    "Solo": false,
    "img": "LinaBenSalem.jpg"
  },
  "AdnenBenAbdelaali": {
    "pastPairs": [
      "BilelGharbi",
      "MohamedSbeta",
      "AhmedWheida",
      "AdamMomen"
    ],
    "Solo": false,
    "img": "AdnenBenAbdelaali.jpg"
  },
  "BilelGharbi": {
    "pastPairs": [
      "AdnenBenAbdelaali",
      "MohamedSbeta",
      "HashemBuzer",
      "WajdiHamrouni"
    ],
    "Solo": false,
    "img": "BilelGharbi.jpg"
  },
  "MohamedSbeta": {
    "pastPairs": [
      "BilelGharbi",
      "AdnenBenAbdelaali",
      "SalimAliAlsaeh",
      "HashemBuzer"
    ],
    "Solo": false,
    "img": "MohamedSbeta.jpg"
  }
}

function each(coll, f) {  // just utility functions to avoid repetition
  if (Array.isArray(coll)) {
    for (var i = 0; i < coll.length; i++) {
      f(coll[i], i);
    }
  } else {
    for (var key in coll) {
      f(coll[key], key);
    }
  }
}

function filter(array, predicate) {
  var acc = [];
  each(array, function(element, i) {
    if (predicate(element, i)) {
      acc.push(element);
    }
  });
  return acc;
}

function filterOut(studentList,pairsList){  // this function takes the student list and filter out all the names that are present in the past pairs list of one student 
    var arr = studentList;
	return filter(arr,function(element){
	   return pairsList.includes(element) === false;
	})
}
 
function choosePair(student,listOfStudents){ // this function takes a student and a list of potentional pairs and pairs him/her with one 
	var arr = filterOut(listOfStudents,Students[student].pastPairs); 
	arr.splice(arr.indexOf(student),1) // to pairing a student with himself
	return [student, arr[Math.floor(Math.random() * Math.floor(arr.length))]]; //the functon returns the pair names in an array of two
}

function addToPastpairs (arr){ // this function adds one pair to the master list of pairs
	Students[arr[0]].pastPairs.push(arr[1])
	Students[arr[1]].pastPairs.push(arr[0])
}

function findSolo(obj){  // this function chooses a sad person to be solo with 
	var arr = filter (Object.keys(obj),function(element){
		return Students[element].Solo === false; // we dnt want one person to be solo multiple times now would we? 
	})
	var sadPerson = arr[Math.floor(Math.random() * Math.floor(arr.length))];
	Students[sadPerson].Solo = true; // making sure the sad person never goes through that experience again 
	return [sadPerson,'solo'];	
}

function pairing(studentData) {

	var list = Object.keys(studentData); //list of the students in an array
	var pairs = []; // the master pairs list 
	
	if(list.length % 2 === 1){		// making sure the number of students is even by making one sad person be solo
		pairs.push(findSolo(Students));
		list.splice(list.indexOf(pairs[0][0]),1); //exculuding that sad guy 
  }
	
	while(list.length > 0){
		var arr = choosePair(list[0],list); //we chose a pair for the the first student
		addToPastpairs(arr) // add both of them to each other's past pair list 
		list.splice(0,1) // we delete both of thm from the current list 
		list.splice(list.indexOf(arr[1]),1) 
		pairs.push(arr); //push the pair to the master pair list 
	}
  	
  	return pairs;
} 
 //////////////////
function Manipulate(obj){
	var manipModule = {};
	manipModule.studentsList = obj;
	manipModule.changePic = changePic;
	manipModule.changeName = changeName;
  manipModule.giantResetButton = giantResetButton
	return manipModule;
}
var changePic = function(student,newPic) {
	this.studentsList[student].img = newPic
} 

var changeName = function(wrongName,correctName){
	this.studentsList[correctName] = this.studentsList[wrongName];
	delete this.studentsList[wrongName]
}

var giantResetButton = function(){
  each(Students,function(student,studentName){
    studentName.pastPairs = [];
    studentName.Solo = false;
  })
}
